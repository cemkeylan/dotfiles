#!/bin/sh

if [ -e $HOME/.night ]
then
	case $1 in
		"click")
			NIGHT=$(tail -n -1 $HOME/.night)
			if [ $NIGHT = 'NIGHT=1' ]
			then
				NIGHT='NIGHT=0'
			else
				NIGHT='NIGHT=1'
			fi
			echo 'CLICK=1' > $HOME/.night
			echo $NIGHT >> $HOME/.night
			;;
		"disable")
			NIGHT=$(tail -n -1 $HOME/.night)
			echo 'CLICK=0' > $HOME/.night
			echo $NIGHT >> $HOME/.night
			$HOME/bin/nightmodetoggle cron
			exit
			;;
		"cron")
			if [ $(head -n +1 $HOME/.night) = "CLICK=1" ]
			then
				exit
			else
				if [ `date +%H%M` -gt "1959" ] ||  [ `date +%H%M` -lt "0600" ]
				then
					printf "CLICK=0\nNIGHT=1" > $HOME/.night	
				else
					printf "CLICK=0\nNIGHT=0" > $HOME/.night	
				fi
			fi
			;;
		*)
			printf "Please enter an argument!\ne.g.\nclick\ndisable\ncron\n"
			exit
			;;
	esac
	if [ $(tail -n -1 $HOME/.night) = "NIGHT=1" ]
	then
		feh --bg-fill --randomize $HOME/Pictures/Wallpapers/Night/*	
		case $(ps aux | grep -i polybar) in
			*night*)
				exit
				;;
			*)
				$HOME/bin/polyrestart night
				;;
		esac
	else
		feh --bg-fill --randomize $HOME/Pictures/Wallpapers/Morning/*	
		case $(ps aux | grep -i polybar | head -n +1 -) in
			*"polybar -q top")
				exit
				;;
			*)
				$HOME/bin/polyrestart morning
				;;
		esac
	fi
else
	touch $HOME/.night
	printf "CLICK=0\nNIGHT=0" > $HOME/.night
fi
