#!/usr/bin/env sh

if [ -e $HOME/.night ]
then
	case $1 in
		"click")
			NIGHT=$(tail -n -1 $HOME/.night)
			if [ $NIGHT = 'NIGHT=1' ]
			then
				NIGHT='NIGHT=0'
			else
				NIGHT='NIGHT=1'
			fi
			echo 'CLICK=1' > $HOME/.night
			echo $NIGHT >> $HOME/.night
			;;
		"disable")
			NIGHT=$(tail -n -1 $HOME/.night)
			echo 'CLICK=0' > $HOME/.night
			echo $NIGHT >> $HOME/.night
			$HOME/.local/bin/nightmodetoggle cron
			exit
			;;
		"cron")
			if [ $(head -n +1 $HOME/.night) = "CLICK=1" ]
			then
				exit
			else
				[ -e $HOME/.sunset ] && . $HOME/.sunset
				[ -z $SUNSET ] && SUNSET=1959
				[ -z $SUNRISE ] && SUNRISE=0600
				if [ `date +%H%M` -gt "$SUNSET" ] ||  [ `date +%H%M` -lt "$SUNRISE" ]
				then
					printf "CLICK=0\nNIGHT=1" > $HOME/.night	
				else
					printf "CLICK=0\nNIGHT=0" > $HOME/.night	
				fi
			fi
			;;
		*)
			printf "Please enter an argument!\ne.g.\nclick\ndisable\ncron\n"
			exit
			;;
	esac
	if [ $(tail -n -1 $HOME/.night) = "NIGHT=1" ]
	then

		feh --bg-fill --randomize $HOME/Pictures/Wallpapers/Night/*	
	else
		feh --bg-fill --randomize $HOME/Pictures/Wallpapers/Morning/*	
	fi
else
	touch $HOME/.night
	printf "CLICK=0\nNIGHT=0" > $HOME/.night
fi
